
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="jmol">
    <title>模块化你的javascript - jmol</title>
    <meta name="author" content="Jmol">
    
        <link rel="icon" href="/assets/images/favicon.ico">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="随着互联网的飞速发展，用户和企业对web前端的展示和交互要求也越来越高；而在web铁三角(html+css+js)中扮演很重要角色的javascript也在不断的前进；从最初web1.0被用于做前端表单校验和网页动画；">
<meta property="og:type" content="blog">
<meta property="og:title" content="模块化你的javascript">
<meta property="og:url" content="http://www.jmolboy.com/2015/10/27/moduleyourjavascript/index.html">
<meta property="og:site_name" content="jmol">
<meta property="og:description" content="随着互联网的飞速发展，用户和企业对web前端的展示和交互要求也越来越高；而在web铁三角(html+css+js)中扮演很重要角色的javascript也在不断的前进；从最初web1.0被用于做前端表单校验和网页动画；">
<meta property="og:image" content="http://7xnu0w.com1.z0.glb.clouddn.com/web_js_html_css.jpg">
<meta property="og:image" content="http://7xnu0w.com1.z0.glb.clouddn.com/commonjs_modules.png">
<meta property="og:updated_time" content="2015-11-06T09:00:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="模块化你的javascript">
<meta name="twitter:description" content="随着互联网的飞速发展，用户和企业对web前端的展示和交互要求也越来越高；而在web铁三角(html+css+js)中扮演很重要角色的javascript也在不断的前进；从最初web1.0被用于做前端表单校验和网页动画；">
    
    
    
        <meta property="og:image" content="http://7xnu0w.com1.z0.glb.clouddn.com/avatar.jpg"/>
    
    
        <meta property="og:image" content="http://7xnu0w.com1.z0.glb.clouddn.com/js.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://7xnu0w.com1.z0.glb.clouddn.com/js.png" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">jmol</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="/#about">
        
        
            <img class="header-picture" src="http://7xnu0w.com1.z0.glb.clouddn.com/avatar.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="http://7xnu0w.com1.z0.glb.clouddn.com/avatar.jpg"/>
            </a>
            <span class="sidebar-profile-name">Jmol</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">关于</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            模块化你的javascript
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Tue Oct 27 2015 21:39:47 GMT+0800">
	
		    10月 27, 2015
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/javascript/">javascript</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>随着互联网的飞速发展，用户和企业对web前端的展示和交互要求也越来越高；而在web铁三角(html+css+js)中扮演很重要角色的javascript也在不断的前进；从最初web1.0被用于做前端表单校验和网页动画；<a id="more"></a>到web2.0时代利用ajax做异步更新及html5标准api的制定，javascript开始被广泛的关注和应用；在web2.0流行的时代，各种前端库和框架被开发出来，javascript也从最初的兼容各版本浏览器、表单校验上升到应用开发的级别上；<br><img src="http://7xnu0w.com1.z0.glb.clouddn.com/web_js_html_css.jpg" alt=""></p>
<p>经历了不断的应用和探索，javascript不断被抽象和封装以支持越来越复杂的业务逻辑，从单一的前端交互上升到业务处理；后来nodejs的出现又让javascript可以应用于服务端开发、网络编程，从客户端编程语言跃升到服务端语言；</p>
<p>伴随着的是javascirpt代码量越来越多了，业务越来越复杂了，各种依赖层次越来越深了，版本越来越不好控制了；那怎么解决呢？答案就是 <strong>模块化</strong> (什么是<a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="external">模块系统和模块化</a>可参考<a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="external">https://github.com/seajs/seajs/issues/242</a>)</p>
<h2 id="传统的模块化方式">传统的模块化方式</h2><p>传统的处理方式大多包括以下几类：</p>
<ul>
<li>文件拆分</li>
<li>全局变量</li>
<li>命名空间</li>
<li>YUI3类似的模块化方式</li>
</ul>
<p>但是这些方式都能一时的解决问题，但也会带来新的问题；具体详见<a href="https://github.com/seajs/seajs/issues/547" target="_blank" rel="external">前端模块化开发的价值</a>(by玉伯)</p>
<h2 id="CommonJs">CommonJs</h2><p>2009年Node的横空出世，人们可以用javascript编写服务端代码了；于是大牛云集的<a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank" rel="external">CommonJS</a>(过去叫ServerJS)发力了，推出了<a href="http://wiki.commonjs.org/wiki/Modules" target="_blank" rel="external">Modules/1.0</a>规范。接下来，在Nodejs中得到了不错的实践；CommonJS定义的规范十分简单，主要分为模块引用、模块定义和模块标识3个部分</p>
<h4 id="模块引用">模块引用</h4><p>在CommonJS中使用require()方法，这个方法接受模块标识，以此引入一个模块的到当前上下文中。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> math=<span class="built_in">require</span>(<span class="string">'math'</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="模块定义">模块定义</h4><p>在模块中，上下文提供require()方法来引入外部模块；对应引入的功能，上下文提供exports对象用于导出当前模块的属性或方法，并且是唯一的出口。在模块中还有一个module对象，它代表模块自身，儿exports是module的属性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//math.js</span></span><br><span class="line">exports.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span>, i = <span class="number">0</span>, args = <span class="built_in">arguments</span>, l = args.length;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; l) &#123;</span><br><span class="line">    sum += args[i++];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>在另一个文件中我们可以使用require()方法引入它，接着就能访问它了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//program.js</span></span><br><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br><span class="line">math.increment = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> add(val, <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h4 id="模块标识">模块标识</h4><p>模块标识其实就是require()方法的参数，上文的<code>var math = require(&#39;math&#39;)</code>中的math就是模块标识，它是一个小驼峰的字符串，可以没有文件后缀名的.js</p>
<p>模块的定义和接口都很简洁，它的存在是将类聚的方法和变量限定在私有的作用域中，且提供引入和导出功能以方便的连接上下文依赖；每个模块有独立的空间，互不干扰。</p>
<p><img src="http://7xnu0w.com1.z0.glb.clouddn.com/commonjs_modules.png" alt=""></p>
<p>javascript在Node出现以后，相比别的编程语言多了一项优势，那就是一些模块可以在前后端公用，因为这些Api在各个宿主环境下都有提供，单在实际中还是有差别的。</p>
<ul>
<li>多终端而言：浏览器端的javascript需要经历从服务端下载到多个客户端执行；服务端javascript则是相同的代码需要多次执行；</li>
<li>浏览器端javascript依赖于带宽；服务端javascript依赖于CPU和内存等资源；</li>
<li>浏览器端需要从网络端加载代码；服务端则是从磁盘中加载；两者加载速度不在一个数量级上</li>
</ul>
<p>整个在服务端的引入过程，几乎都是同步的，但是如果前端模块也用同步的方式来引入，用户体验将会大打折扣，UI在初始化过程中需要花费很多时间来等待脚本的加载。</p>
<p>鉴于网络的原因，CommonJS为服务端javascript制定的规范并不完全适用于前端场景。经过激烈的争论后，AMD(Asynchronous Module Definition)异步模块定义在前端场景中胜出(可参考<a href="https://github.com/seajs/seajs/issues/588" target="_blank" rel="external">前端模块化开发那点历史</a>)，另外还有玉伯定义的CMD规范。</p>
<h2 id="AMD规范">AMD规范</h2><p>AMD(Asynchronous Module Definition)规范的代表是requirejs，在前端异步加载所需要的模块，在回调函数中执行主逻辑，这点其实广大前端开发着并不陌生；AMD规范的内容包含：</p>
<ul>
<li><p>使用全局define方法来定义模块</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(id,dependencies,factory);</span><br></pre></td></tr></table></figure>
</li>
<li><p>id是模块标识；dependencies是依赖的模块数组；模块id参数和依赖参数是可选的，factory的内容就是实际代码了。比如：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> exports=&#123;&#125;;</span><br><span class="line">	exports.hello=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alter(<span class="string">'hello'</span>);			</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> exports;		</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>factory参数如果是函数，对外公开api的方法有：A.return数据；B.exports导出；C.module.exports导出；</p>
</li>
<li><p>如果factory为对象，则该对象即为模块的返回值。例如:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//alert.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'excute alert.js'</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    alert: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'hello, alert'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//confirm.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'excute confirm.js'</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">     confirm: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'hello, pls confirm'</span>);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'alert'</span>, <span class="string">'confirm'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">alert, confirm</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'excute main.js'</span>);</span><br><span class="line">   alert.alert();</span><br><span class="line">   $(<span class="string">'#confirm'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      confirm.hello();</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>运行上面main.js后，会先后输出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">excute alert.js</span><br><span class="line"></span><br><span class="line">excute confirm.js</span><br><span class="line"></span><br><span class="line">excute main.js</span><br><span class="line"></span><br><span class="line">hello,alert</span><br></pre></td></tr></table></figure>
<p>点击confirm按钮后会输出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello,pls confirm</span><br></pre></td></tr></table></figure>
<p>你是否会高兴的说：终于模块化啦；可是你应该发现，在我们还没有点击confirm按钮时，confirm.js已经被执行过了；因为web本身的特点，预先下载被依赖的模块自然没什么问题，可是是否需要预先执行呢？那么当一个模块依赖了好多个别的模块，在执行自身模块之前需要将依赖的模块都预执行而不管他们是否会立刻用到，在很多情境下，就会导致页面响应迟钝，浏览器内存狂升；</p>
<p>当然后来requirejs也做了兼容Modules/Wrappings的写法，AMD将此兼容称为Simplified CommonJS wrapping，即并不是完整的实现Modules/Wrappings。<br>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dialog.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'excute dialog.js'</span>);</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">      alert: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">           <span class="keyword">var</span> alt = <span class="built_in">require</span>(<span class="string">'alert'</span>);</span><br><span class="line">           alt.alert();</span><br><span class="line">      &#125;,</span><br><span class="line">      run: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">         $(<span class="string">'#confirm'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> cfm = <span class="built_in">require</span>(<span class="string">'confirm'</span>);</span><br><span class="line">            cfm.confirm();</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然看起来感觉好多了，使用的时候主动require添加引用，而其实它只是支持了这样的语法，依旧没有真正的实现模块的延后执行。比如上面的代码，正常理解是会首先预下载alert.js和confirm.js，然后在执行dialog.js的alert方法时执行alert.js代码，在点击confirm按钮后才开始执行confirm.js里的代码。实际却不是这样，只要模块被引用进来，alert.js和confirm.js都被预先执行了。如果我们在引用一下dialog.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">'dialog'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">dialog</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>就会输出：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">excute alert.js</span><br><span class="line"></span><br><span class="line">excute confirm.js</span><br><span class="line"></span><br><span class="line">excute dialog.js</span><br></pre></td></tr></table></figure></p>
<h2 id="CMD规范">CMD规范</h2><p>CMD(Common Module Definition)规范由国内的玉伯提出，代表是玉伯的<a href="https://github.com/seajs/seajs" target="_blank" rel="external">seajs</a>，与AMD规范的主要区别在于定义模块和依赖引入；具体<a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="external">CMD模块定义规范</a>详见<a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="external">https://github.com/seajs/seajs/issues/242</a>，使用CMD的seajs，上面代码就可以这样编写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//alert.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'excute alert.js'</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    alert: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'hello, alert'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//confirm.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'excute confirm.js'</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">     confirm: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'hello, pls confirm'</span>);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'excute main.js'</span>);</span><br><span class="line">   <span class="keyword">var</span> alt=<span class="built_in">require</span>(<span class="string">'alert'</span>);</span><br><span class="line">   alt.alert();</span><br><span class="line">   $(<span class="string">'#confirm'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> cfm=<span class="built_in">require</span>(<span class="string">'confirm'</span>);</span><br><span class="line">		cfm.hello();</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上面代码执行就会输出：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">excute main.js</span><br><span class="line"></span><br><span class="line">excute alert.js</span><br><span class="line"></span><br><span class="line">hello, alert</span><br></pre></td></tr></table></figure></p>
<p>此过程中alert.js和confirm.js都会先下载，但是confirm.js并不会先执行；而是等到点击按钮以后才执行。比如点击按钮以后会输出：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">excute confirm.js</span><br><span class="line"></span><br><span class="line">hello,pls confirm</span><br></pre></td></tr></table></figure></p>
<p>这样才既在语法上又在实现上实现了预先下载、延迟引用、延迟执行的目的；</p>
<p>当然seajs也支持在模块内部异步加载模块，并提供了异步加载结束后的回调</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>.async(id, callback?)</span><br></pre></td></tr></table></figure>
<p>例如上面的mainjs就可以这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'excute main.js'</span>);</span><br><span class="line">   <span class="built_in">require</span>.async(<span class="string">'alert'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">alt</span>)</span>&#123;</span><br><span class="line">		alt.alert();</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   $(<span class="string">'#confirm'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">require</span>.async(<span class="string">'confirm'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">cfm</span>)</span>&#123;</span><br><span class="line">			cfm.hello();</span><br><span class="line">		&#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>seajs和requirejs的异同，按作者的定义主要体现在这几点：(参考自<a href="https://github.com/seajs/seajs/issues/277" target="_blank" rel="external">与 RequireJS 的异同</a>)</p>
<ul>
<li><strong>定位有差异</strong>。RequireJS 想成为浏览器端的模块加载器，同时也想成为 Rhino / Node 等环境的模块加载器。Sea.js 则专注于 Web 浏览器端，同时通过 Node 扩展的方式可以很方便跑在 Node 环境中。</li>
<li><strong>遵循的规范不同</strong>。RequireJS 遵循 AMD（异步模块定义）规范，Sea.js 遵循 CMD （通用模块定义）规范。规范的不同，导致了两者 API 不同。Sea.js 更贴近 CommonJS Modules/1.1 和 Node Modules 规范。</li>
<li><strong>推广理念有差异</strong>。RequireJS 在尝试让第三方类库修改自身来支持 RequireJS，目前只有少数社区采纳。Sea.js 不强推，采用自主封装的方式来“海纳百川”，目前已有较成熟的封装策略。</li>
<li><strong>对开发调试的支持有差异</strong>。Sea.js 非常关注代码的开发调试，有 nocache、debug 等用于调试的插件。RequireJS 无这方面的明显支持</li>
<li><strong>插件机制不同</strong>。RequireJS 采取的是在源码中预留接口的形式，插件类型比较单一。Sea.js 采取的是通用事件机制，插件类型更丰富</li>
</ul>
<p>总结下就是，如果说 RequireJS 是 Prototype 类库的话，则 Sea.js 致力于成为 jQuery 类库。</p>
<p>更多seajs信息，请移步<a href="http://seajs.org/" target="_blank" rel="external">http://seajs.org/</a></p>
<h2 id="兼容多种规范">兼容多种规范</h2><p>那么有咩有办法让开发出的模块能同时兼容前后端呢，当然有…但是为了能够前后端保持一致，最好的做法就是将我们的代码放入一个独立的闭包里。以便能同时兼容Nodejs、AMD、CMD以及普通的浏览器环境。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">name,definition</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//检测是否为AMD或CMD</span></span><br><span class="line">    <span class="keyword">var</span> hasDefine=<span class="keyword">typeof</span> define === <span class="string">'function'</span>,</span><br><span class="line">    <span class="comment">//是否为Node</span></span><br><span class="line">    hasExports=<span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">module</span>.exports;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(hasDefine)&#123;</span><br><span class="line">        <span class="comment">//AMD或CMD</span></span><br><span class="line">        define(definition);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(hasExports)&#123;</span><br><span class="line">        <span class="comment">//普通Node模块</span></span><br><span class="line">        <span class="built_in">module</span>.exports=definition();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//将执行结果挂在window变量中，在浏览器中this指向window对象</span></span><br><span class="line">        <span class="keyword">this</span>[name]=definition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="string">'hello'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hello=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">    <span class="comment">//hello.xx=xx</span></span><br><span class="line">    <span class="keyword">return</span> hello;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>(当然这个还可以继续重构)  </p>
<p><strong>ps:关于seajs的详细应用，后续会详细介绍.</strong></p>
<h5 id="参考资源">参考资源</h5><p>[CMD 模块定义规范]  <a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="external">https://github.com/seajs/seajs/issues/242</a></p>
<p>[前端模块化开发的价值] <a href="https://github.com/seajs/seajs/issues/547" target="_blank" rel="external">https://github.com/seajs/seajs/issues/547</a></p>
<p>[与 RequireJS 的异同]<a href="https://github.com/seajs/seajs/issues/277" target="_blank" rel="external">https://github.com/seajs/seajs/issues/277</a></p>
<p>[深入浅出Node]作者朴灵&nbsp;<a href="https://github.com/jacksontian" target="_blank" rel="external">https://github.com/jacksontian</a></p>

            
                

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/javascript/">javascript</a> <a class="tag tag--primary tag--small t-link" href="/tags/requirejs/">requirejs</a> <a class="tag tag--primary tag--small t-link" href="/tags/seajs/">seajs</a> <a class="tag tag--primary tag--small t-link" href="/tags/模块化/">模块化</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/10/23/beginlearnnode/" data-tooltip="开始nodejs">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#comments">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-moduleyourjavascript" data-title="模块化你的javascript" data-url="http://www.jmolboy.com/2015/10/27/moduleyourjavascript/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {short_name:'jmolboy'};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共JS代码 end -->
</section>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2015 Jmol. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/10/23/beginlearnnode/" data-tooltip="开始nodejs">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#comments">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
            
        </div>
        <!-- Define author's picture -->


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="http://7xnu0w.com1.z0.glb.clouddn.com/avatar.jpg"/>
        
            <h4 id="about-card-name">Jmol</h4>
        
            <h5 id="about-card-bio"><p>Time is a bird for ever on the wing</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software Engineer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                BeiJing
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('http://7xnu0w.com1.z0.glb.clouddn.com/cover2.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->


    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','76FNrggKSASvR2yBxCW5','2.0.0');
    </script>

<!--STYLES END-->

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-58121600-2']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>



</html>
